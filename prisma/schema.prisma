generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum UserRole {
  ADMIN
  PONTOFOCAL
}

model User {
  id            String   @id @default(uuid())
  nome          String
  username      String   @unique
  password      String
  orgaoDeOrigem String
  role          UserRole @default(PONTOFOCAL)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Modalidade {
  id                  String                @id @default(uuid())
  nome                String
  descricao           String
  categoria           String[]              @default([])
  maxParticipantes    Int
  participantesAtuais Int                   @default(0)
  regras              String[]              @default([])
  premios             String[]              @default([])
  status              String                @default("inscricoes-abertas")
  divisoes            String[]
  modalidadesSexo     String[]              @default([])
  faixaEtaria         String[]              @default(["Adulto"])
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  classificacoes      Classificacao[]
  eventos             Evento[]
  inscricoes          InscricaoModalidade[]
}

model Inscricao {
  id             String                @id @default(uuid())
  nome           String
  email          String
  cpf            String                @unique
  dataNascimento DateTime
  telefone       String
  sexo           String?
  camiseta       String
  lotacao        String
  orgaoOrigem    String
  matricula      String                @unique
  status         String                @default("pendente")
  createdAt      DateTime              @default(now())
  updatedAt      DateTime              @updatedAt
  classificacoes Classificacao[]
  modalidades    InscricaoModalidade[]
}

model InscricaoModalidade {
  id           String     @id @default(uuid())
  inscricaoId  String
  modalidadeId String
  sexo         String?
  divisao      String?
  categoria    String?
  faixaEtaria  String?
  createdAt    DateTime   @default(now())
  inscricao    Inscricao  @relation(fields: [inscricaoId], references: [id], onDelete: Cascade)
  modalidade   Modalidade @relation(fields: [modalidadeId], references: [id], onDelete: Cascade)

  @@unique([inscricaoId, modalidadeId])
}

model Evento {
  id            String      @id @default(uuid())
  atividade     String
  inicio        DateTime
  fim           DateTime
  local         String?
  detalhes      String?
  modalidadeId  String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  modalidadeRel Modalidade? @relation(fields: [modalidadeId], references: [id])

  @@index([inicio])
  @@index([modalidadeId])
}

model Classificacao {
  id           String     @id @default(uuid())
  modalidadeId String
  posicao      Int
  inscricaoId  String?
  lotacao      String?
  pontuacao    Int
  tempo        String?
  distancia    String?
  observacoes  String?
  atleta       String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  inscricao    Inscricao? @relation(fields: [inscricaoId], references: [id])
  modalidade   Modalidade @relation(fields: [modalidadeId], references: [id], onDelete: Cascade)

  @@index([modalidadeId])
  @@index([inscricaoId])
  @@index([lotacao])
}

model Midia {
  id        String   @id @default(uuid())
  tipo      String
  url       String
  titulo    String?
  destaque  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tipo])
  @@index([destaque])
}
